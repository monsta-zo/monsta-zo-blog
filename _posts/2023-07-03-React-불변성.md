---
layout: single
title: "[React] 리액트의 불변성 "
categories: React
tag: [React]
toc: true
toc_sticky: true
author_profile: false
sidebar:
 nav: "docs"
header:
 teaser: /assets/images/react.png

---

리액트에서 불변성이라는 개념은 아주 중요하다. 

## 불변성이란?

불변성이란 값이 변하지 않는 것을 말한다. 원시타입은 불변성을 가진다. 예시를 들어 설명해보자

```js
let str = 'one';
str = 'two';
```

위는 지금 불변성을 지키고 있는 것이다. 아니 분명 값이 `one`에서 `two`로 변했는데 이게 불변성을 가지는 것이지?

바로 자바스크립트는 값을 재할당할 때, 기존의 `one`이란 값을 `two`로 바꾸는 것이 아닌, `str`이라는 변수가 원래 `one`을 놔두고 `two`라는 값을 가르키게 하는 것이다. 즉, 기존의 `one`이란 값은 변하지 않으므로 불변성을 지키는 것이다. 

그렇다면 원시타입이 아닌 참조타입을 보자

```js
let arr = [1, 2, 3, 4];
array.push(5);

arr = [1, 2, 3, 4];
```

위의 `push`는 불변성을 지키지 않는다. 그 이유는 기존의 배열이 `5`라는 값이 추가되면서 변했기 때문이다. 

아래의 새로운 배열을 재할당하는 부분은 불변성을 지키는 것이다.

<br>

즉, 쉽게 말해서 불변성을 지킨다는 것은 변수에 다른 값을 할당하지 않는다는 것이 아닌, **메모리에 있는 값을 변경하지 않겠다는 것**이다. 

## 리액트에서의 불변성

그럼 리액트에서 불변성이라는 개념이 왜 중요할까? 이는 `state`와 깊은 연관이 있다.

리액트에서는 `state`의 값이 변하면 컴포넌트를 리렌더링한다. 이때, `state`의 값이 변경되었는지 확인하기 위해서 기존의 `state`와 얕은 비교를 한다.

여기서 얕은 비교란 값을 비교하는 것이 아닌, 단순히 참조가 같은지 비교하는 것이다. 

즉, 리액트에서 `state`가 변했다는 것은 기존의 `state`가 새로운 `state`와 서로 다른 참조값을 가진다는 것이다. 아까 위에서 참조값이 다르다는 것은 불변성을 지키는 것이라고 했다. 왜냐면 기존의 값을 변경하지 않았기 때문이다.

한마디로, 리액트는 우리가 불변성을 지킴으로써 상태변화를 감지할 수 있다. 

그럼 어떻게 불변성을 지켜줘야할까?

*원시 타입*

원시 타입은 어짜피 새로운 값을 할당해야하므로, 불변성이 자동으로 지켜진다. 따라서 상태값을 변화시킬  때, 그냥 새로운 값을 재할당해주면 된다.

```jsx
const [number, setNumber] = useState(0)
setState(3)
```

*참조 타입*

하지만 참조 타입은 다르다. 우리는 배열을 변화시키기위해 주로 요소를 삭제하거나 추가한다. 하지만 이렇게 되면 우리는 불변성을 어기는 것이다. 기존의 값을 변화시켰기 때문이다. 따라서 우린 참조 타입의 상태변화에서 불변성을 지키기 위해 기존의 상태인 배열이나 객체를 변화시키는 것이 아닌, 수정된 배열이나 객체를 *새로*만들어서 할당해줘야한다.

(**spread 연산자, map, filter, slice, reduce** 등이 주로 사용됨, 모두 새로운 객체나 배열을 반환하는 메소드이다)

```jsx
const [person, setPerson] = useState({ name: '', age: 30 })
setState({...person, name: 'pyo'})
```
